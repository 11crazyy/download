<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.httpdownloadserver.dao.TaskDAO">
    <resultMap id="TasksMap" type="com.example.httpdownloadserver.dataobject.TaskDO">
        <result column="id" jdbcType="INTEGER" property="id"/>
        <result column="status" jdbcType="VARCHAR" property="status"/>
        <result column="download_speed" jdbcType="DOUBLE" property="downloadSpeed"/>
        <result column="download_progress" jdbcType="INTEGER" property="downloadProgress"/>
        <result column="download_remaining_time" jdbcType="INTEGER" property="downloadProgress"/>
        <result column="current_slice" jdbcType="INTEGER" property="currentSlice"/>
        <result column="download_thread" jdbcType="INTEGER" property="downloadThread"/>
        <result column="download_path" jdbcType="VARCHAR" property="downloadPath"/>
        <result column="download_link" jdbcType="VARCHAR" property="downloadLink"/>
        <result column="gmt_created" jdbcType="TIMESTAMP" property="gmtCreated"/>
        <result column="gmt_modified" jdbcType="TIMESTAMP" property="gmtModified"/>
    </resultMap>
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        insert into task (status,
                          download_speed,
                          download_progress,
                          download_remaining_time,
                          current_slice,
                          download_thread,
                          download_path,
                          download_link)
        values (#{status},
                #{downloadSpeed},
                #{downloadProgress},
                #{downloadRemainingTime},
                #{currentSlice},
                #{downloadThread},
                #{downloadPath},
                #{downloadLink})
    </insert>
    <delete id="deleteById">
        delete
        from task
        where id = #{id}
    </delete>
    <select id="selectById" resultType="com.example.httpdownloadserver.dataobject.TaskDO">
        select id,
               status,
               download_speed,
               download_progress,
               download_remaining_time,
               current_slice,
               download_thread,
               download_path,
               download_link,
               gmt_created,
               gmt_modified
        from task
        where id = #{id}
    </select>
    <select id="selectAll" resultType="com.example.httpdownloadserver.dataobject.TaskDO">
        select id,
               status,
               download_speed,
               download_progress,
               download_remaining_time,
               current_slice,
               download_thread,
               download_path,
               download_link,
               gmt_created,
               gmt_modified
        from task
    </select>
    <select id="selectByStatus" resultMap="TasksMap"
            parameterType="java.lang.String">
        select id,
               status,
               download_speed,
               download_progress,
               download_remaining_time,
               current_slice,
               download_thread,
               download_path,
               download_link,
               gmt_created,
               gmt_modified
        from task
        where status = #{status,jdbcType=VARCHAR}
    </select>
    <delete id="deleteByIds">
        delete
        from task
        where id in
        <foreach collection="ids" item="id" open="(" separator="," close=")">
            #{id}
        </foreach>
    </delete>
    <update id="updateThreadById">
        update task
        set download_thread = #{downloadThread}
        where id = #{id}
    </update>
    <select id="getThreadById" parameterType="Integer" resultType="int">
        select download_thread
        from task
        where id = #{id}
    </select>
    <update id="updateById" parameterType="int">
        update task
        set status = #{status},
            download_speed = #{downloadSpeed},
            download_progress = #{downloadProgress},
            download_remaining_time = #{downloadRemainingTime},
            current_slice = #{currentSlice},
            download_thread = #{downloadThread},
            download_path = #{downloadPath},
            download_link = #{downloadLink}
        where id = #{id}
    </update>

</mapper>